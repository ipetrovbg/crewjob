(function(){    var app = angular.module('crewjob');    var projectViewCtrl = function($scope, $http, $rootScope, $routeParams, $timeout, $cookies, toastinoService, projectServices, $location, userServices, auth, $interval){        projectServices.getProject($routeParams.project_id)            .success(function(response){                if(response.status){                    $scope.projectTitle = response.project.name;                    $scope.projectId = response.project.id;                    $scope.projectDescription = response.project.description;                    $scope.projectImages = response.project.images;                    var count = 0;                    angular.forEach($scope.projectImages, function(v, k){                        var url = $rootScope.base_url + '/uploads/project/thumbs/' + v.file_name;                        $http.get(url).success(function(response, status){                            if(status == 200){                                $scope.projectImages[count].file_name = url;                            }else{                                $scope.projectImages[count].file_name = $rootScope.base_url + '/uploads/project/' + v.file_name;                            }                        }).error(function(){                            $scope.projectImages[count].file_name = $rootScope.base_url + '/uploads/project/' + v.file_name;                        });                        count++;                    });                    console.log($scope.projectImages);                    $scope.projectFiles = response.project.files;                    $scope.location = response.project.location;                    if(response.project.status == '0' || response.project.status == '2'){                        toastinoService.makeDangerToast('Проектът не беше намерен!', 'long');                        $location.path('projects/');                    }                    $scope.projectCoords = {                        latitude: response.project.latitude,                        longitude: response.project.longitude                    };                    $scope.map = { center: { latitude:  response.project.latitude,  longitude: response.project.longitude }, zoom: 8 };                    userServices.getUserSmallInfo(response.project.user_id)                        .success(function(response){                            $scope.projectUserAvatar = response.user.avatar;                            $scope.projectUserName = response.user.name;                            $scope.projectUserEmail = response.user.email;                            $scope.projectUserId = response.user.id;                        }).error(function(promise){                        console.log(promise);                    });                    projectServices.getProjectCategories($routeParams.project_id)                        .success(function(response){                            console.log(response);                            $scope.projectCategories = response.categories;                        }).error(function(promise){                       console.log(promise);                    });                    auth.isAuth().then(function(response){                        if(response.auth){                            if($scope.projectUserId == $cookies.get('ID')){                                $scope.isAuthor = true;                            }else{                                $scope.isAuthor = false;                            }                        }                        $scope.auth = response.auth;                    });                    /*Applying for project*/                $scope.apply = function(){                    // console.log($routeParams.project_id);                    // console.log($cookies.get('ID'));                    projectServices.applying($routeParams.project_id)                        .success(function(response){                            if(response.project_status){                                if(response.isApplying){                                    toastinoService.makeWarningToast('Вече сте кандидатствал за този проект!', 'long');                                }else{                                    if(response.status){                                        toastinoService.makeSuccessToast('Успешно кандидатствахте за проекта!', 'long');                                    }else{                                        toastinoService.makeWarningToast('Не успяхте да кандидатствате, моля опитайте отново!', 'long');                                    }                                }                            }else{                                toastinoService.makeWarningToast('Проектът е затворен за кандидатстване!', 'long');                            }                        }).error(function(reason){                        toastinoService.makeDangerToast('Нещо се обърка, моля опитайте отново!', 'long');                    });                };                }else{                    toastinoService.makeDangerToast('Няма такъв проект!', 'long');                    $location.path('/projects');                }            }).error(function(reason){            console.log(reason);        });    };    app.controller('projectViewCtrl', projectViewCtrl);}());